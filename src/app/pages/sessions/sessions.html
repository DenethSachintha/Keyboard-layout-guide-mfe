<p-toolbar
  [style]="{
    'border-radius': '3rem',
    'padding': '1rem 2.5rem 1rem 1.5rem',
    'margin-bottom': '1rem'
  }"
>
  <ng-template #start>
    <div class="flex items-center gap-2">
      <span class="page-title">Module {{ moduleId }} Sessions Summary</span>
    </div>
  </ng-template>
</p-toolbar>

<div class="card">
  <!-- ✅ Loading -->
  <div
    *ngIf="isLoading"
    class="flex justify-center items-center p-8 text-surface-600 dark:text-surface-400"
  >
    <i class="pi pi-spin pi-spinner text-xl mr-2"></i>
    Loading sessions...
  </div>

  <!-- ✅ Empty -->
  <div
    *ngIf="!isLoading && sessionSummaries.length === 0"
    class="flex justify-center items-center p-8 text-surface-600 dark:text-surface-400"
  >
    <i class="pi pi-info-circle mr-2"></i>
    No sessions found for this module.
  </div>

  <!-- ✅ Data -->
  <p-dataview
    *ngIf="!isLoading && sessionSummaries.length > 0"
    #dv
    [value]="sessionSummaries"
    [layout]="layout"
  >
    <ng-template #header>
      <div class="flex justify-end">
        <p-selectbutton [(ngModel)]="layout" [options]="options" [allowEmpty]="false">
          <ng-template #item let-item>
            <i class="pi" [ngClass]="{ 'pi-bars': item === 'list', 'pi-table': item === 'grid' }"></i>
          </ng-template>
        </p-selectbutton>
      </div>
    </ng-template>

    <!-- ✅ List View -->
    <ng-template #list let-items>
      <div *ngFor="let session of items; let first = first">
        <div
          class="flex flex-col sm:flex-row sm:items-center p-6 gap-10"
          [ngClass]="{ 'border-t border-surface-200 dark:border-surface-700': !first }"
        >
          <div class="text-center">
              <i
                class="pi"
                [ngClass]="session.isCompleted ? 'pi-check-circle text-green-500' : 'pi-clock text-yellow-500'"
                style="font-size: 2rem"
              ></i>
              <p-tag
                [value]="session.isCompleted ? 'Completed' : 'In Progress'"
                [severity]="session.isCompleted ? 'success' : 'warn'"
                class="mt-2"
              ></p-tag>
            </div>

          <div class="flex flex-col md:flex-row justify-between md:items-center flex-1 gap-6">
            <div class="flex flex-col gap-1">
              <div class="text-lg font-medium">Session #{{ session.sessionId }}</div>
              <p class="text-sm text-surface-600 dark:text-surface-400">
                <strong>Average Accuracy:</strong> {{ session.avgAccuracy }}%
              </p>
              <p class="text-sm text-surface-600 dark:text-surface-400">
                <strong>Average WPM:</strong> {{ session.avgWpm }}
              </p>
              <p class="text-sm text-surface-600 dark:text-surface-400">
                <strong>Total Time:</strong> {{ session.totalTimeSeconds }}s
              </p>
              <p class="text-sm text-surface-600 dark:text-surface-400">
                <strong>Date:</strong> {{ session.dateTime | date: 'medium' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </ng-template>

    <!-- ✅ Grid View -->
    <ng-template #grid let-items>
      <div class="grid grid-cols-12 gap-4">
        <div *ngFor="let session of items" class="col-span-12 sm:col-span-6 md:col-span-4 xl:col-span-3 p-2">
          <div
            class="p-6 border border-surface-200 dark:border-surface-700 rounded flex flex-col bg-surface-0 dark:bg-surface-900"
          >
            <div class="text-center">
              <i
                class="pi"
                [ngClass]="session.isCompleted ? 'pi-check-circle text-green-500' : 'pi-clock text-yellow-500'"
                style="font-size: 2rem"
              ></i>
              <p-tag
                [value]="session.isCompleted ? 'Completed' : 'In Progress'"
                [severity]="session.isCompleted ? 'success' : 'warn'"
                class="mt-2"
              ></p-tag>
            </div>

            <div class="pt-4 flex flex-col gap-2 text-center">
              <div class="text-lg font-medium">Session #{{ session.sessionId }}</div>
              <p class="text-sm"><strong>Avg Accuracy:</strong> {{ session.avgAccuracy }}%</p>
              <p class="text-sm"><strong>Avg WPM:</strong> {{ session.avgWpm }}</p>
              <p class="text-sm"><strong>Total Time:</strong> {{ session.totalTimeSeconds }}s</p>
              <p class="text-sm"><strong>Date:</strong> {{ session.dateTime | date: 'medium' }}</p>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </p-dataview>
</div>
