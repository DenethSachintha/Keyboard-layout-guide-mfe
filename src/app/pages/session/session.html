<div class="flex flex-col" style="height: calc(100vh - 81px);">
  
  <p-toolbar [style]="{ 'border-radius': '3rem', 'padding': '1rem 2.5rem 1rem 1.5rem', 'margin-bottom': '1rem' }">
  <ng-template #start>
     <div class="flex items-center gap-2">
      <span class="page-title">Typing Modules</span>
    </div>
  </ng-template>

  <ng-template #end>
    <div class="flex items-center gap-2">
      @if(!isStarted() && !isPaused() && !isEnded()){
        <p-button icon="pi pi-play" aria-label="Start"  [pTooltip]="'Start'" tooltipPosition="bottom" (click)="startSession()" severity="success" size="small" />
      }
      @if(isStarted() && !isPaused()){
        <p-button icon="pi pi-pause" aria-label="Pause"  [pTooltip]="'Pause'" tooltipPosition="bottom" (click)="pauseSession()" severity="info" size="small" />
      }
      @if(isPaused()){
        <p-button icon="pi pi-play" aria-label="Resume"  [pTooltip]="'Resume'" tooltipPosition="bottom" (click)="resumeSession()" severity="info" size="small" />
      }
      @if(isStarted() || isPaused()){
        <p-button icon="pi pi-times" aria-label="End"  [pTooltip]="'End'" tooltipPosition="bottom" (click)="endSession()" severity="warn" size="small" />
      }
      @if(isStarted() || isPaused() || isEnded()){
        <p-button icon="pi pi-refresh" aria-label="Reset"  [pTooltip]="'Reset'" tooltipPosition="bottom" (click)="resetSession()" severity="danger" size="small" />
      }
    </div>
  </ng-template>
</p-toolbar>
<div class="card">
  <!-- Stepper -->
  <p-stepper [value]="currentStep()" [linear]="true" class="basis-[50rem]">
    <p-step-list (click)="onStepClick($event)">
      <p-step *ngFor="let s of sentences(); let idx = index" [value]="idx + 1">
        Step
      </p-step>
    </p-step-list>

    <p-step-panels>
      <p-step-panel *ngFor="let s of sentences(); let idx = index" [value]="idx">
        <ng-template #content let-activateCallback="activateCallback">
          <div class="flex flex-col gap-4">
            <div
              class="border-2 border-dashed border-surface-200 dark:border-surface-700 rounded bg-surface-50 dark:bg-surface-950 p-4">
              <!-- Sentence display -->
              <div class="mb-3">
                <strong>Step {{ idx + 1 }}:</strong>
                <div class="sentence-text mt-2">
                  <span *ngFor="let ch of (wordArray()); let i = index" style="padding: 2px;"
                    [class.correct]="result()[i] === 'correct'" [class.incorrect]="result()[i] === 'incorrect'"
                    [class.pending]="result()[i] === 'pending'">
                    {{ ch }}
                  </span>
                </div>
              </div>

              <!-- Typing area (readonly display; typing captured via document key events) -->
              <div class="typing-area mt-4 p-3 border rounded bg-white">
                <div class="typed-text">
                  <span *ngFor="let ch of userInput(); let i = index">
                    {{ ch || '\u00A0' }}
                  </span>
                </div>
                <p class="hint text-sm mt-2">Start typing to begin (session auto-starts).</p>
              </div>

              <!-- Step stats (if completed) -->
              <!-- <div class="step-stats mt-3" *ngIf="sessionRecords.length > 0 && sessionRecords | slice:-1:">
            </div> -->
            </div>
          </div>
        </ng-template>
      </p-step-panel>
    </p-step-panels>
  </p-stepper>
</div>
<!-- Debug / Records panel -->
<!-- <div class="mt-4">
  <h4>Session Records</h4>
  <ul>
    <li *ngFor="let rec of sessionRecords">
      Step {{ rec.stepIndex + 1 }} — Words WPM: {{ rec.wpm }} — Accuracy: {{ rec.accuracy }}% — Time:
      {{ rec.stepTimeSeconds }}s — {{ rec.dateTime }}
    </li>
  </ul>
</div> -->

<div class="wrapper">
  <div class="content">
    <!-- Keyboard layout -->
    <div class="keyboard-wrapper">
      <app-layout-view
        [keyMapping]="keyMapping"
        [isShiftActive]="isShiftActive()"
        [expectedKeyId]="expectedKeyId()"
      ></app-layout-view>
    </div>
  </div>
</div>
</div>